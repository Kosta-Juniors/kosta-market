<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>K-Market - 당신이 찾는 모든 상품</title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Place favicon.png in the root directory -->
    <link rel="shortcut icon" href="http://127.0.0.1/img/favicon.png" type="image/x-icon" />
    <!-- Font Icons css -->
    <link rel="stylesheet" href="http://127.0.0.1/css/font-icons.css">
    <!-- plugins css -->
    <link rel="stylesheet" href="http://127.0.0.1/css/plugins.css">
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="http://127.0.0.1/css/style.css">
    <!-- Responsive css -->
    <link rel="stylesheet" href="http://127.0.0.1/css/responsive.css">
</head>

<body>
    <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->

    <!-- Add your site or application content here -->

<!-- Body main wrapper start -->
<div class="body-wrapper">

    <!-- HEADER AREA START (header-3) -->
    <header id="header-area"></header>
    <!-- HEADER AREA END -->

    <!-- MOBILE MENU START -->
    <div class="mobile-header-menu-fullwidth mb-30 d-block d-lg-none">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <!-- Mobile Menu Button -->
                    <div class="mobile-menu-toggle d-lg-none">
                        <span>MENU</span>
                        <a href="#ltn__utilize-mobile-menu" class="ltn__utilize-toggle">
                            <svg viewBox="0 0 800 600">
                                <path d="M300,220 C300,220 520,220 540,220 C740,220 640,540 520,420 C440,340 300,200 300,200" id="top"></path>
                                <path d="M300,320 L540,320" id="middle"></path>
                                <path d="M300,210 C300,210 520,210 540,210 C740,210 640,530 520,410 C440,330 300,190 300,190" id="bottom" transform="translate(480, 320) scale(1, -1) translate(-480, -318) "></path>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- MOBILE MENU END -->

    <!-- Utilize Cart Menu Start -->
    <div id="ltn__utilize-cart-menu" class="ltn__utilize ltn__utilize-cart-menu">
        <div class="ltn__utilize-menu-inner ltn__scrollbar">
            <div class="ltn__utilize-menu-head">
                <span class="ltn__utilize-menu-title">Cart</span>
                <button class="ltn__utilize-close">×</button>
            </div>
            <div class="mini-cart-product-area ltn__scrollbar">
                <div class="mini-cart-item clearfix">
                    <div class="mini-cart-img">
                        <a href="#"><img src="http://127.0.0.1/img/product/1.png" alt="Image"></a>
                        <span class="mini-cart-item-delete"><i class="icon-cancel"></i></span>
                    </div>
                    <div class="mini-cart-info">
                        <h6><a href="#">Antiseptic Spray</a></h6>
                        <span class="mini-cart-quantity">1 x $65.00</span>
                    </div>
                </div>
                <div class="mini-cart-item clearfix">
                    <div class="mini-cart-img">
                        <a href="#"><img src="http://127.0.0.1/img/product/2.png" alt="Image"></a>
                        <span class="mini-cart-item-delete"><i class="icon-cancel"></i></span>
                    </div>
                    <div class="mini-cart-info">
                        <h6><a href="#">Digital Stethoscope</a></h6>
                        <span class="mini-cart-quantity">1 x $85.00</span>
                    </div>
                </div>
                <div class="mini-cart-item clearfix">
                    <div class="mini-cart-img">
                        <a href="#"><img src="http://127.0.0.1/img/product/3.png" alt="Image"></a>
                        <span class="mini-cart-item-delete"><i class="icon-cancel"></i></span>
                    </div>
                    <div class="mini-cart-info">
                        <h6><a href="#">Cosmetic Containers</a></h6>
                        <span class="mini-cart-quantity">1 x $92.00</span>
                    </div>
                </div>
                <div class="mini-cart-item clearfix">
                    <div class="mini-cart-img">
                        <a href="#"><img src="http://127.0.0.1/img/product/4.png" alt="Image"></a>
                        <span class="mini-cart-item-delete"><i class="icon-cancel"></i></span>
                    </div>
                    <div class="mini-cart-info">
                        <h6><a href="#">Thermometer Gun</a></h6>
                        <span class="mini-cart-quantity">1 x $68.00</span>
                    </div>
                </div>
            </div>
            <div class="mini-cart-footer">
                <div class="mini-cart-sub-total">
                    <h5>Subtotal: <span>$310.00</span></h5>
                </div>
                <div class="btn-wrapper">
                    <a href="cart.html" class="theme-btn-1 btn btn-effect-1">View Cart</a>
                    <a href="cart.html" class="theme-btn-2 btn btn-effect-2">Checkout</a>
                </div>
                <p>Free Shipping on All Orders Over $100!</p>
            </div>

        </div>
    </div>
    <!-- Utilize Cart Menu End -->

    <!-- Utilize Mobile Menu Start -->
    <div id="ltn__utilize-mobile-menu" class="ltn__utilize ltn__utilize-mobile-menu">
        <div class="ltn__utilize-menu-inner ltn__scrollbar">
            <div class="ltn__utilize-menu-head">
                <div class="site-logo">
                    <a href="/"><img src="http://127.0.0.1/img/logo.png" alt="Logo"></a>
                </div>
                <button class="ltn__utilize-close">×</button>
            </div>
            <div class="ltn__utilize-menu-search-form">
                <form action="#">
                    <input type="text" placeholder="Search...">
                    <button><i class="fas fa-search"></i></button>
                </form>
            </div>
            <div class="ltn__utilize-menu">
                <ul>
                    <li><a href="#">Home</a>
                        <ul class="sub-menu">
                            <li><a href="/">Home Style 01</a></li>
                            <li><a href="index-2.html">Home Style 02</a></li>
                            <li><a href="index-3.html">Home Style 03</a></li>
                        </ul>
                    </li>
                    <li><a href="#">About</a>
                        <ul class="sub-menu">
                            <li><a href="about.html">About</a></li>
                            <li><a href="service.html">Services</a></li>
                            <li><a href="service-details.html">Service Details</a></li>
                            <li><a href="portfolio.html">Portfolio</a></li>
                            <li><a href="portfolio-2.html">Portfolio - 02</a></li>
                            <li><a href="portfolio-details.html">Portfolio Details</a></li>
                            <li><a href="team.html">Team</a></li>
                            <li><a href="team-details.html">Team Details</a></li>
                            <li><a href="faq.html">FAQ</a></li>
                            <li><a href="locations.html">Google Map Locations</a></li>
                        </ul>
                    </li>
                    <li><a href="#">Shop</a>
                        <ul class="sub-menu">
                            <li><a href="shop.html">Shop</a></li>
                            <li><a href="shop-grid.html">Shop Grid</a></li>
                            <li><a href="shop-left-sidebar.html">Shop Left sidebar</a></li>
                            <li><a href="shop-right-sidebar.html">Shop right sidebar</a></li>
                            <li><a href="product-details.html">Shop details </a></li>
                            <li><a href="cart.html">Cart</a></li>
                            <li><a href="wishlist.html">Wishlist</a></li>
                            <li><a href="checkout.html">Checkout</a></li>
                            <li><a href="order-tracking.html">Order Tracking</a></li>
                            <li><a href="account.html">My Account</a></li>
                            <li><a href="login.html">Sign in</a></li>
                            <li><a href="register.html">Register</a></li>
                        </ul>
                    </li>
                    <li><a href="#">News</a>
                        <ul class="sub-menu">
                            <li><a href="blog.html">News</a></li>
                            <li><a href="blog-grid.html">News Grid</a></li>
                            <li><a href="blog-left-sidebar.html">News Left sidebar</a></li>
                            <li><a href="blog-right-sidebar.html">News Right sidebar</a></li>
                            <li><a href="blog-details.html">News details</a></li>
                        </ul>
                    </li>
                    <li><a href="#">Pages</a>
                        <ul class="sub-menu">
                            <li><a href="about.html">About</a></li>
                            <li><a href="service.html">Services</a></li>
                            <li><a href="service-details.html">Service Details</a></li>
                            <li><a href="portfolio.html">Portfolio</a></li>
                            <li><a href="portfolio-2.html">Portfolio - 02</a></li>
                            <li><a href="portfolio-details.html">Portfolio Details</a></li>
                            <li><a href="team.html">Team</a></li>
                            <li><a href="team-details.html">Team Details</a></li>
                            <li><a href="faq.html">FAQ</a></li>
                            <li><a href="history.html">History</a></li>
                            <li><a href="add-listing.html">Add Listing</a></li>
                            <li><a href="locations.html">Google Map Locations</a></li>
                            <li><a href="404.html">404</a></li>
                            <li><a href="contact.html">Contact</a></li>
                            <li><a href="coming-soon.html">Coming Soon</a></li>
                        </ul>
                    </li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
            <div class="ltn__utilize-buttons ltn__utilize-buttons-2">
                <ul>
                    <li>
                        <a href="account.html" title="My Account">
                            <span class="utilize-btn-icon">
                                <i class="far fa-user"></i>
                            </span>
                            My Account
                        </a>
                    </li>
                    <li>
                        <a href="wishlist.html" title="Wishlist">
                            <span class="utilize-btn-icon">
                                <i class="far fa-heart"></i>
                                <sup>3</sup>
                            </span>
                            Wishlist
                        </a>
                    </li>
                    <li>
                        <a href="cart.html" title="Shoping Cart">
                            <span class="utilize-btn-icon">
                                <i class="fas fa-shopping-cart"></i>
                                <sup>5</sup>
                            </span>
                            Shoping Cart
                        </a>
                    </li>
                </ul>
            </div>
            <div class="ltn__social-media-2">
                <ul>
                    <li><a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a></li>
                    <li><a href="#" title="Twitter"><i class="fab fa-twitter"></i></a></li>
                    <li><a href="#" title="Linkedin"><i class="fab fa-linkedin"></i></a></li>
                    <li><a href="#" title="Instagram"><i class="fab fa-instagram"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Utilize Mobile Menu End -->

    <div class="ltn__utilize-overlay"></div>


    <!-- SHOP DETAILS AREA START -->
    <div class="ltn__shop-details-area pt-40 pb-85">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-12">
                    <div class="ltn__shop-details-inner mb-60">
                        <!-- 상품 메인컨텐츠 시작-->
                        <div class="row">
                            <!-- 상품이미지 목록 시작-->
                            <div class="col-md-6">
                                <div class="ltn__shop-details-img-gallery">
                                    <div class="ltn__shop-details-large-img">
                                        <div class="single-large-img">
                                            <a href="img/product/1.png" data-rel="lightcase:myCollection">
                                                <img src="http://127.0.0.1/img/product/1.png" alt="Image">
                                            </a>
                                        </div>
                                        <div class="single-large-img">
                                            <a href="img/product/2.png" data-rel="lightcase:myCollection">
                                                <img src="http://127.0.0.1/img/product/2.png" alt="Image">
                                            </a>
                                        </div>
                                        <!-- 
                                        <div class="single-large-img">
                                            <a href="img/product/3.png" data-rel="lightcase:myCollection">
                                                <img src="http://127.0.0.1/img/product/3.png" alt="Image">
                                            </a>
                                        </div>
                                        <div class="single-large-img">
                                            <a href="img/product/4.png" data-rel="lightcase:myCollection">
                                                <img src="http://127.0.0.1/img/product/4.png" alt="Image">
                                            </a>
                                        </div>
                                        <div class="single-large-img">
                                            <a href="img/product/5.png" data-rel="lightcase:myCollection">
                                                <img src="http://127.0.0.1/img/product/5.png" alt="Image">
                                            </a>
                                        </div>
                                        <div class="single-large-img">
                                            <a href="img/product/6.png" data-rel="lightcase:myCollection">
                                                <img src="http://127.0.0.1/img/product/6.png" alt="Image">
                                            </a>
                                        </div>
                                        <div class="single-large-img">
                                            <a href="img/product/7.png" data-rel="lightcase:myCollection">
                                                <img src="http://127.0.0.1/img/product/7.png" alt="Image">
                                            </a>
                                        </div>
                                        -->
                                    </div>
                                    <!-- 서브 이미지 목록 시작-->
                                    <!-- <div class="ltn__shop-details-small-img slick-arrow-2">
                                        <div class="single-small-img">
                                            <img src="http://127.0.0.1/img/product/1.png" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img src="http://127.0.0.1/img/product/2.png" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img src="http://127.0.0.1/img/product/3.png" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img src="http://127.0.0.1/img/product/4.png" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img src="http://127.0.0.1/img/product/5.png" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img src="http://127.0.0.1/img/product/6.png" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img src="http://127.0.0.1/img/product/7.png" alt="Image">
                                        </div>
                                        
                                    </div> --> 
                                    <!-- 서브 이미지 목록 끝-->
                                </div>
                            </div>
                            <!-- 상품이미지 목록 끝-->


                            <!-- 상품 설명 시작 -->
                            <div class="col-md-6" id="shop-details-info">
                            </div>
                        </div>
                        <!-- 상품 메인컨텐츠 끝-->
                    </div>



                    <!-- Shop Tab Start -->
                    <div class="ltn__shop-details-tab-inner ltn__shop-details-tab-inner-2">
                        <div class="ltn__shop-details-tab-menu">
                            <div class="nav">
                                <a class="active show" data-bs-toggle="tab" href="#liton_tab_details_1_1">Description</a>
                                <a data-bs-toggle="tab" href="#liton_tab_details_1_2" class="">Reviews</a>
                            </div>
                        </div>

                        <div class="tab-content" id="tab-content">
                        </div>
                    </div>
                    <!-- Shop Tab End -->
                </div>




                <div class="col-lg-4">
                    <aside class="sidebar ltn__shop-sidebar ltn__right-sidebar">
                        <!-- Top Rated Product Widget -->
                        <div class="widget ltn__top-rated-product-widget">
                            <h4 class="ltn__widget-title ltn__widget-title-border">Top Rated Product</h4>
                            <ul id="top-rated-product-items">
                            </ul>
                        </div>
                        <!-- Banner Widget -->
                        <div class="widget ltn__banner-widget" id="banner-widget">
                            
                        </div>
                    </aside>
                </div>
            </div>
        </div>
    </div>
    <!-- SHOP DETAILS AREA END -->

    <!-- PRODUCT SLIDER AREA START -->
    <div class="ltn__product-slider-area ltn__product-gutter pb-70">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title-area ltn__section-title-2">
                        <h4 class="title-2">Related Products<span>.</span></h1>
                    </div>
                </div>
            </div>
            <div class="row ltn__related-product-slider-one-active slick-arrow-1" id="related-product-slider-items">
                <!-- 여기에 슬라이드 아이템 들어감 -->
            </div>
        </div>
    </div>
    <!-- PRODUCT SLIDER AREA END -->

    <!-- FOOTER AREA START -->
    <footer class="ltn__footer-area" id="footer-area"></footer>
    <!-- FOOTER AREA END -->

</div>
<!-- Body main wrapper end -->

    <!-- All JS Plugins -->
    <script src="http://127.0.0.1/js/plugins.js" defer></script>
    <!-- Main JS -->
    <script src="http://127.0.0.1/js/main.js" defer></script>
    <!-- Custom JS -->
    <script src="http://127.0.0.1/js/custom/component.js" defer></script>
    <script src="http://127.0.0.1/js/custom/user.js" defer></script>
    <script src="http://127.0.0.1/js/custom/product.js" defer></script>
    <script src="http://127.0.0.1/js/custom/order.js" defer></script>

    <script defer>
        window.addEventListener('DOMContentLoaded', (event) => {
            console.log('DOM fully loaded and parsed');
            init()
        });

        let user
        let productDetail = {}
        let relatedProductList = {}
        let topRatedProductList = {}
        let banner = {}
        let reviewList = []
        let totalReviewScore 
        let productId = window.location.pathname.split("/").slice(-1)

        async function init(){
            let reviewPagenation = 1
            let reviewSize = 10

            Promise.all([
                getProduct(productId).catch(error => {return error}),
                getTopRatedProductList().catch(error => {return error}),
                getRelatedProductList().catch(error => {return error}),
                getBanner().catch(error => {return error}),
                getReviewList(productId, reviewPagenation, reviewSize).catch(error => {return error}),
                getTotalReviewScore().catch(error => {return error}),
                getUser().catch(error => {return error})
            ]).then((results) => {
                console.log(results)
                productDetail = results[0]
                topRatedProductList = results[1]
                relatedProductList = results[2]
                banner = results[3]
                reviewList = results[4]
                totalReviewScore = results[5]
                user = results[6]

                render()
                setBind()
            })
        }

        function render(){
            // 헤더 추가
            $("#header-area").append(headerHTML(user))
            $("#footer-area").append(footerHTML())

            let shopDetailHtml = ""
            
            let tabContentHtml = ""

            let descriptionHtml = ""
            let reviewListHtml = ""
            let reviewListHeader = ""
            let reviewListItem = ""
            let reviewListFooter = ""
            

            let relatedProductSliderHtml = ""
            let topRatedProductListHtml = ""
            



            // 상품 상세 설명 시작
            descriptionHtml = `
                <div class="tab-pane fade active show" id="liton_tab_details_1_1">
                    <div class="ltn__shop-details-tab-content-inner">
                        <h4 class="title-2">` + productDetail.productDescription + `</h4>
                        <p>` + productDetail.productDescription + `</p>
                    </div>
                </div>
            `
            // 상품 상세 설명 끝

            // 리뷰 리스트 시작
            reviewListHeader = `
                <div class="ltn__comment-area mb-30">
                    <div class="ltn__comment-inner">
                        <ul>`

            reviewListFooter = `
                        </ul>
                    </div>
                </div>`
            
            //////// 리뷰 반복 생성 시작
            for(review of reviewList){
                
                reviewListItem += `
                    <li>
                        <div class="ltn__comment-item clearfix">
                            <div class="ltn__commenter-img">
                                <img src="http://127.0.0.1/img/testimonial/1.jpg" alt="Image">
                            </div>
                            <div class="ltn__commenter-comment">
                                <h6><a href="#">` + review.author + `</a></h6>
                                ` + commentStarComponent(review.score) + `
                                <p>` + review.content + `</p>
                                <span class="ltn__comment-reply-btn">` + review.createdAt + `</span>
                            </div>
                        </div>
                    </li>`
            }
            //////// 리뷰 반복 생성 끝


            reviewListHtml = `
                <div class="tab-pane fade" id="liton_tab_details_1_2">
                    <div class="ltn__shop-details-tab-content-inner">
                        <h4 class="title-2">Customer Reviews</h4>
                        <div class="product-ratting" id="product-ratting">
                            <ul>
                                <li><a href="#"><i class="fas fa-star"></i></a></li>
                                <li><a href="#"><i class="fas fa-star"></i></a></li>
                                <li><a href="#"><i class="fas fa-star"></i></a></li>
                                <li><a href="#"><i class="fas fa-star-half-alt"></i></a></li>
                                <li><a href="#"><i class="far fa-star"></i></a></li>
                                <li class="review-total"> <a href="#"> ( 95 Reviews )</a></li>
                            </ul>
                        </div>
                        <hr>
                        <!-- comment-area -->
                        ` + reviewListHeader + `
                        ` + reviewListItem + `
                        ` + reviewListFooter + `
                    </div>
                </div>`


            tabContentHtml += descriptionHtml
            tabContentHtml += reviewListHtml
            // 리뷰 리스트 끝
            

            // 관련 상품 슬라이드 시작
            relatedProductSliderHtml = relatedProductSliderComponent(relatedProductList)
            // 관련 상품 슬라이드 끝

            
            $("#shop-details-info").append(shopDetailsInfoComponent(productDetail))
            $("#banner-widget").append(bannerComponent(banner))
            $("#tab-content").append(tabContentHtml)
            $("#related-product-slider-items").append(relatedProductSliderHtml)
            $("#top-rated-product-items").append(topRatedProductListComponent(topRatedProductList))
            // productDetail = results[0]
            // -relativeProduct = results[1]
            // topRatedProduct = results[2]
            // -banner = results[3]
            // -reviewList = results[4]
            // totalReviewScore = results[5]
        }

        const bind = {
            addToCart : () => {
                const productId = window.location.pathname.split('/').slice(-1)
                const productQty = $("#input-quantity").val()
                addCart(productId, productQty)
                .then(() => {
                    new bootstrap.Modal(document.getElementById("add_to_cart_modal")).toggle()
                })
                .catch(() => {alert("장바구니 등록 실패")})
            },
            wishlist : () => {}
        }

        function setBind(){
            // data-bs-toggle="modal" data-bs-target="#add_to_cart_modal"
            $("#btn-add-to-cart").click(bind.addToCart)
            $("#btn-checkout").click(function(){
                window.location.href="http://127.0.0.1/order?productList="+productId+":1"
            })
            
        }
    </script>
</body>
</html>