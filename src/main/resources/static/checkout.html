<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>K-Market - 당신이 찾는 모든 상품</title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Place favicon.png in the root directory -->
    <link rel="shortcut icon" href="http://127.0.0.1/img/favicon.png" type="image/x-icon" />
    <!-- Font Icons css -->
    <link rel="stylesheet" href="http://127.0.0.1/css/font-icons.css">
    <!-- plugins css -->
    <link rel="stylesheet" href="http://127.0.0.1/css/plugins.css">
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="http://127.0.0.1/css/style.css">
    <!-- Responsive css -->
    <link rel="stylesheet" href="http://127.0.0.1/css/responsive.css">
</head>

<body>
    <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->

    <!-- Add your site or application content here -->

<!-- Body main wrapper start -->
<div class="body-wrapper">

    <!-- HEADER AREA START (header-3) -->
    <header id="header-area"></header>
    <!-- HEADER AREA END -->

    <!-- MOBILE MENU START -->
    <div class="mobile-header-menu-fullwidth mb-30 d-block d-lg-none">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <!-- Mobile Menu Button -->
                    <div class="mobile-menu-toggle d-lg-none">
                        <span>MENU</span>
                        <a href="#ltn__utilize-mobile-menu" class="ltn__utilize-toggle">
                            <svg viewBox="0 0 800 600">
                                <path d="M300,220 C300,220 520,220 540,220 C740,220 640,540 520,420 C440,340 300,200 300,200" id="top"></path>
                                <path d="M300,320 L540,320" id="middle"></path>
                                <path d="M300,210 C300,210 520,210 540,210 C740,210 640,530 520,410 C440,330 300,190 300,190" id="bottom" transform="translate(480, 320) scale(1, -1) translate(-480, -318) "></path>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- MOBILE MENU END -->

    <!-- Utilize Cart Menu Start -->
    <div id="ltn__utilize-cart-menu" class="ltn__utilize ltn__utilize-cart-menu">
        <div class="ltn__utilize-menu-inner ltn__scrollbar">
            <div class="ltn__utilize-menu-head">
                <span class="ltn__utilize-menu-title">Cart</span>
                <button class="ltn__utilize-close">×</button>
            </div>
            <div class="mini-cart-product-area ltn__scrollbar">
                <div class="mini-cart-item clearfix">
                    <div class="mini-cart-img">
                        <a href="#"><img src="img/product/1.png" alt="Image"></a>
                        <span class="mini-cart-item-delete"><i class="icon-cancel"></i></span>
                    </div>
                    <div class="mini-cart-info">
                        <h6><a href="#">Antiseptic Spray</a></h6>
                        <span class="mini-cart-quantity">1 x $65.00</span>
                    </div>
                </div>
                <div class="mini-cart-item clearfix">
                    <div class="mini-cart-img">
                        <a href="#"><img src="img/product/2.png" alt="Image"></a>
                        <span class="mini-cart-item-delete"><i class="icon-cancel"></i></span>
                    </div>
                    <div class="mini-cart-info">
                        <h6><a href="#">Digital Stethoscope</a></h6>
                        <span class="mini-cart-quantity">1 x $85.00</span>
                    </div>
                </div>
                <div class="mini-cart-item clearfix">
                    <div class="mini-cart-img">
                        <a href="#"><img src="img/product/3.png" alt="Image"></a>
                        <span class="mini-cart-item-delete"><i class="icon-cancel"></i></span>
                    </div>
                    <div class="mini-cart-info">
                        <h6><a href="#">Cosmetic Containers</a></h6>
                        <span class="mini-cart-quantity">1 x $92.00</span>
                    </div>
                </div>
                <div class="mini-cart-item clearfix">
                    <div class="mini-cart-img">
                        <a href="#"><img src="img/product/4.png" alt="Image"></a>
                        <span class="mini-cart-item-delete"><i class="icon-cancel"></i></span>
                    </div>
                    <div class="mini-cart-info">
                        <h6><a href="#">Thermometer Gun</a></h6>
                        <span class="mini-cart-quantity">1 x $68.00</span>
                    </div>
                </div>
            </div>
            <div class="mini-cart-footer">
                <div class="mini-cart-sub-total">
                    <h5>Subtotal: <span>$310.00</span></h5>
                </div>
                <div class="btn-wrapper">
                    <a href="cart.html" class="theme-btn-1 btn btn-effect-1">View Cart</a>
                    <a href="cart.html" class="theme-btn-2 btn btn-effect-2">Checkout</a>
                </div>
                <p>Free Shipping on All Orders Over $100!</p>
            </div>

        </div>
    </div>
    <!-- Utilize Cart Menu End -->

    <!-- Utilize Mobile Menu Start -->
    <div id="ltn__utilize-mobile-menu" class="ltn__utilize ltn__utilize-mobile-menu">
        <div class="ltn__utilize-menu-inner ltn__scrollbar">
            <div class="ltn__utilize-menu-head">
                <div class="site-logo">
                    <a href="index.html"><img src="img/logo.png" alt="Logo"></a>
                </div>
                <button class="ltn__utilize-close">×</button>
            </div>
            <div class="ltn__utilize-menu-search-form">
                <form action="#">
                    <input type="text" placeholder="Search...">
                    <button><i class="fas fa-search"></i></button>
                </form>
            </div>
            <div class="ltn__utilize-menu">
                <ul>
                    <li><a href="#">Home</a>
                        <ul class="sub-menu">
                            <li><a href="index.html">Home Style 01</a></li>
                            <li><a href="index-2.html">Home Style 02</a></li>
                            <li><a href="index-3.html">Home Style 03</a></li>
                        </ul>
                    </li>
                    <li><a href="#">About</a>
                        <ul class="sub-menu">
                            <li><a href="about.html">About</a></li>
                            <li><a href="service.html">Services</a></li>
                            <li><a href="service-details.html">Service Details</a></li>
                            <li><a href="portfolio.html">Portfolio</a></li>
                            <li><a href="portfolio-2.html">Portfolio - 02</a></li>
                            <li><a href="portfolio-details.html">Portfolio Details</a></li>
                            <li><a href="team.html">Team</a></li>
                            <li><a href="team-details.html">Team Details</a></li>
                            <li><a href="faq.html">FAQ</a></li>
                            <li><a href="locations.html">Google Map Locations</a></li>
                        </ul>
                    </li>
                    <li><a href="#">Shop</a>
                        <ul class="sub-menu">
                            <li><a href="shop.html">Shop</a></li>
                            <li><a href="shop-grid.html">Shop Grid</a></li>
                            <li><a href="shop-left-sidebar.html">Shop Left sidebar</a></li>
                            <li><a href="shop-right-sidebar.html">Shop right sidebar</a></li>
                            <li><a href="product-details.html">Shop details </a></li>
                            <li><a href="cart.html">Cart</a></li>
                            <li><a href="wishlist.html">Wishlist</a></li>
                            <li><a href="checkout.html">Checkout</a></li>
                            <li><a href="order-tracking.html">Order Tracking</a></li>
                            <li><a href="account.html">My Account</a></li>
                            <li><a href="login.html">Sign in</a></li>
                            <li><a href="register.html">Register</a></li>
                        </ul>
                    </li>
                    <li><a href="#">News</a>
                        <ul class="sub-menu">
                            <li><a href="blog.html">News</a></li>
                            <li><a href="blog-grid.html">News Grid</a></li>
                            <li><a href="blog-left-sidebar.html">News Left sidebar</a></li>
                            <li><a href="blog-right-sidebar.html">News Right sidebar</a></li>
                            <li><a href="blog-details.html">News details</a></li>
                        </ul>
                    </li>
                    <li><a href="#">Pages</a>
                        <ul class="sub-menu">
                            <li><a href="about.html">About</a></li>
                            <li><a href="service.html">Services</a></li>
                            <li><a href="service-details.html">Service Details</a></li>
                            <li><a href="portfolio.html">Portfolio</a></li>
                            <li><a href="portfolio-2.html">Portfolio - 02</a></li>
                            <li><a href="portfolio-details.html">Portfolio Details</a></li>
                            <li><a href="team.html">Team</a></li>
                            <li><a href="team-details.html">Team Details</a></li>
                            <li><a href="faq.html">FAQ</a></li>
                            <li><a href="history.html">History</a></li>
                            <li><a href="add-listing.html">Add Listing</a></li>
                            <li><a href="locations.html">Google Map Locations</a></li>
                            <li><a href="404.html">404</a></li>
                            <li><a href="contact.html">Contact</a></li>
                            <li><a href="coming-soon.html">Coming Soon</a></li>
                        </ul>
                    </li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
            <div class="ltn__utilize-buttons ltn__utilize-buttons-2">
                <ul>
                    <li>
                        <a href="account.html" title="My Account">
                            <span class="utilize-btn-icon">
                                <i class="far fa-user"></i>
                            </span>
                            My Account
                        </a>
                    </li>
                    <li>
                        <a href="wishlist.html" title="Wishlist">
                            <span class="utilize-btn-icon">
                                <i class="far fa-heart"></i>
                                <sup>3</sup>
                            </span>
                            Wishlist
                        </a>
                    </li>
                    <li>
                        <a href="cart.html" title="Shoping Cart">
                            <span class="utilize-btn-icon">
                                <i class="fas fa-shopping-cart"></i>
                                <sup>5</sup>
                            </span>
                            Shoping Cart
                        </a>
                    </li>
                </ul>
            </div>
            <div class="ltn__social-media-2">
                <ul>
                    <li><a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a></li>
                    <li><a href="#" title="Twitter"><i class="fab fa-twitter"></i></a></li>
                    <li><a href="#" title="Linkedin"><i class="fab fa-linkedin"></i></a></li>
                    <li><a href="#" title="Instagram"><i class="fab fa-instagram"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Utilize Mobile Menu End -->

    <div class="ltn__utilize-overlay"></div>

    <!-- WISHLIST AREA START -->
    <div class="ltn__checkout-area pt-40 mb-105">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ltn__checkout-inner">
                        <div class="ltn__checkout-single-content mt-50">
                            <h4 class="title-2">주문서 내용</h4>
                            <div class="ltn__checkout-single-content-info">
                                <h6>내 배송지 목록</h6>
                                <div class="row mb-40" id="user-address-list"></div>
                                <form action="#" >
                                    <h6>배송지 정보</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="input-item input-item-name ltn__custom-icon">
                                                <input type="text" name="ltn__name" placeholder="받는 사람명">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="input-item input-item-phone ltn__custom-icon">
                                                <input type="text" name="ltn__phone" placeholder="전화번호">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 col-md-12">
                                            <h6>주소 및 상세주소</h6>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="input-item">
                                                        <input type="text" placeholder="기본 주소">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="input-item">
                                                        <input type="text" placeholder="상세 주소">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <p><label class="input-info-save mb-0"><input type="checkbox" name="agree"> 이 주소를 기본으로 설정할까요?</label></p>
                                    <h6>배송 시 요구사항</h6>
                                    <div class="input-item input-item-textarea ltn__custom-icon">
                                        <textarea name="ltn__message" placeholder="여기에 배송 시 요구사항을 입력해주세요."></textarea>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="ltn__checkout-payment-method mt-50">
                        <h4 class="title-2">결제 수단</h4>
                        <div id="checkout_accordion_1">
                            <!-- card -->
                            <div class="card">
                                <h5 class="collapsed ltn__card-title" data-bs-toggle="collapse" data-bs-target="#faq-item-2-1" aria-expanded="false" onclick="selectPaymentMethod(1)">
                                    계좌이체
                                </h5>
                                <div id="faq-item-2-1" class="collapse" data-bs-parent="#checkout_accordion_1">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12">
                                                <p>은행을 선택하고 결제를 진행해주세요.</p>
                                            </div>
                                            <div class="col-3">
                                                <p>입금은행 : </p>
                                            </div>
                                            <div class="col-9">
                                                <select name="bankType">
                                                    <option value="00" selected>Bank Kosta</option>
                                                    <option value="01">카카오뱅크</option>
                                                    <option value="02">우리은행</option>
                                                    <option value="03">농협은행</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- card -->
                            <div class="card">
                                <h5 class="collapsed ltn__card-title" data-bs-toggle="collapse" data-bs-target="#faq-item-2-2" aria-expanded="false" onclick="selectPaymentMethod(2)">
                                    무통장입금(가상계좌)
                                </h5>
                                <div id="faq-item-2-2" class="collapse" data-bs-parent="#checkout_accordion_1">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-3"><p>입금은행 : </p></div>
                                            <div class="col-9">
                                                <select name="bankType">
                                                    <option value="00" selected>Bank Kosta</option>
                                                    <option value="01">카카오뱅크</option>
                                                    <option value="02">우리은행</option>
                                                    <option value="03">농협은행</option>
                                                </select>
                                            </div>
                                            <div class="col-12"><p>입금기한 : 20xx년 xx월 xx일 xx:xx:xx 까지</p></div>
                                            <div class="col-12"><p><br>* 현금으로 결제한 모든 금액은 우리은행과 채무지급보증계약을 체결하여 고객님의 안전거래를 보장하고 있습니다.</p></div>
                                            <div class="col-12"><p><strong>※무통장입금 시 유의사항</strong></p></div>
                                            <div class="col-12">
                                                <p>- 입금완료 후 상품품절로 인해 자동취소된 상품은 환불 처리해 드립니다.<br>
                                                - 무통장입금 결제 시 부분취소가 불가하며 전체취소 후 다시 주문하시기 바랍니다.<br>
                                                - 은행 이체 수수료가 발생될 수 있습니다. 입금시 수수료를 확인해주세요.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- card -->
                            <div class="card">
                                <h5 class="ltn__card-title" data-bs-toggle="collapse" data-bs-target="#faq-item-2-3" aria-expanded="true" onclick="selectPaymentMethod(3)"> 
                                    휴대폰
                                </h5>
                                <div id="faq-item-2-3" class="collapse show" data-bs-parent="#checkout_accordion_1">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12"><p>통신사 종류를 선택하고 결제를 진행해주세요.</p></div>
                                            <div class="col-3"><p>통신사 : </p></div>
                                            <div class="col-9">
                                                <select name="mobileCarrierType">
                                                    <option value="00" selected>코스텔레콤</option>
                                                    <option value="01">KT</option>
                                                    <option value="02">SK</option>
                                                    <option value="03">LG</option>
                                                    <option value="04">알뜰폰</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>                          
                            <!-- card -->
                            <div class="card">
                                <h5 class="collapsed ltn__card-title" data-bs-toggle="collapse" data-bs-target="#faq-item-2-4" aria-expanded="false" >
                                    신용/체크카드 <img src="img/icons/payment-3.png" alt="#">
                                </h5>
                                <div id="faq-item-2-4" class="collapse" data-bs-parent="#checkout_accordion_1" onclick="selectPaymentMethod(4)">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12"><p>카드종류 및 할부기간을 선택하고 결제를 진행해주세요</p></div>
                                            <div class="col-3"><p>카드종류 : <p></div>
                                            <div class="col-9">
                                                <select name="cardType">
                                                    <option value="00" selected>K-Star 카드</option>
                                                    <option value="01">농협카드</option>
                                                    <option value="02">SK카드</option>
                                                    <option value="03">IBK카드</option>
                                                </select>
                                            </div>
                                            <div class="col-3"><p>할부기간 : </p></div>
                                            <div class="col-9">
                                                <select name="installmentPeriod">
                                                    <option value="00" selected>일시불</option>
                                                    <option value="01">1개월</option>
                                                    <option value="02">3개월</option>
                                                    <option value="03">6개월</option>
                                                    <option value="04">12개월</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <input type="checkbox" name="defaultPayment"> 기본 결제 수단으로 사용
                            
                        </div>
                        <div class="ltn__payment-note mt-30 mb-30">
                            <p>귀하의 개인 데이터는 귀하의 주문을 처리하고, 이 웹사이트 전체에서 귀하의 경험을 지원하고, 당사의 개인정보 보호정책에 설명된 기타 목적을 위해 사용됩니다.</p>
                        </div>
                        <button class="btn theme-btn-1 btn-effect-1 text-uppercase" type="submit" id="btn-make-order">주문하기</button>
                    </div>
                </div>
                <div class="col-lg-6" id="shoping-cart-total">
                </div>
            </div>
        </div>
    </div>
    <!-- WISHLIST AREA START -->
    
    <!-- FOOTER AREA START -->
    <footer class="ltn__footer-area" id="footer-area"></footer>
    <!-- FOOTER AREA END -->
</div>
<!-- Body main wrapper end -->

    
    <!-- All JS Plugins -->
    <script src="http://127.0.0.1/js/plugins.js" defer></script>
    <!-- Main JS -->
    <script src="http://127.0.0.1/js/main.js" defer></script>
    <!-- Custom JS -->
    <script src="http://127.0.0.1/js/custom/component.js" defer></script>
    <script src="http://127.0.0.1/js/custom/user.js" defer></script>
    <script src="http://127.0.0.1/js/custom/product.js" defer></script>
    <script src="http://127.0.0.1/js/custom/order.js" defer></script>
    <script>

        let user
        let orderList
        let addressList

        let selectedAddressId
        let selectedPaymentMethod

        window.addEventListener('DOMContentLoaded', (event) => {
            console.log('DOM fully loaded and parsed');
            init()
        });

        function init(){
            orderList = getOrderParamFromUrl()
            getUser().catch(error => {
                alert("회원정보가 없습니다. 다시 로그인 해주세요")
                window.location.href = "http://127.0.0.1/user/signin"
            }).then(res => {
                user = res
                Promise.all(orderList.map(item => getProduct(item.productId)))
                .then(productList => {
                    
                    for(idx in orderList){
                        orderList[idx]['productName'] = productList[idx]['productName']
                        orderList[idx]['productPrice'] = productList[idx]['productPrice']
                    }  
                }).then(() => { 
                    getDelivery().catch(error => {return error})
                    .then(result => {
                        addressList = result
                        render()
                        bind()
                    })
                })
            })
            
        }

        function render(){
            // 헤더 추가
            $("#header-area").append(headerHTML(user))
            $("#footer-area").append(footerHTML())

            console.log(orderList)
            $("#shoping-cart-total").append(shopingCartTotalComponent(orderList))
            $("#user-address-list").append(addressListComponent(addressList))
        }

        function bind(){
            $("#btn-make-order").click(function(){
                const productListQuery = window.location.search
                addOrder(productListQuery, selectedPaymentMethod, selectedAddressId)
            })
            // $("#").click(function(){
            //     selectAddress
            // })
        }
        
        function selectAddress(addressId){
            selectedAddressId = addressId
            alert(addressId)
        }
        
        function selectPaymentMethod(code){
            selectedPaymentMethod = code
            console.log(code)
        }

        // 확장성 없이 고려된 코드,,, 리팩터링 필요함
        function getOrderParamFromUrl() {
            const urlParamQuery = location.search.substr(location.search.indexOf("?") + 1);
            const params = urlParamQuery.split("&")
            let orderList, rawData
            
            rawData = params[0].split("=")

            orderList = rawData[1].split(",").map(item => {
                return {
                    productId : item.split(":")[0],
                    quantity : item.split(":")[1]
                }
            })

            return orderList;
        }
    </script>
</body>
</html>


